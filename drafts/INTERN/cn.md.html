---
[typora]()-copy-images-to: upload
---

* OSI七层协议

  * 相同：分层的体系结构、独立的协议栈概念、解决异构网络的互联
  * 不同：OSI精确地定义了服务、协议、接口这三个主要概念，OSI通用性好
  * OSI在网络层支持 无连接+面向连接， 传输层仅有面向连接

* TCP/IP五层协议

  * TCP在网络层只有无连接，传输层支持无连接+面向连接

* ![](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281228190.png)

  * 物理层（Physical Layer）：透明的比特流传输

  * 数据链路层（Data Link Layer）

    * 成帧：把连续不断的01比特流，组织成一个个独立的帧，这样出错了就可以只重发出错的帧，提高了效率。
    * 差错控制：产生的原因的网络的噪声干扰等，解决方案一般是采用校验码（检验码=奇偶、循环冗余，纠错码=海明码）。自动重传请求等
    * 流量控制：如果发送方发送能力大于接收方接受能力，来不及接受的帧会被后面的帧“淹没”。解决方案是停止-等待协议，使用顺序号的滑动窗口协议等。
      * 顺序号m比特，接收窗口大小+发送窗口大小=$2^m$.
    * 传输管理

  * 网络层：源端->目的端，主机（由IP地址标识）与主机之间，（点到点的通信，一个点就是一个IP地址或者硬件地址）

    * 传输单位是数据报，功能是异构网络互连+路由选择和转发+拥塞控制
    * 路由
      * 路由算法：静态+动态（距离-向量、链路状态）
      * 路由协议：IGP(使用UDP的RIP （Routing Info P）、使用IP的OSPF、E(Exterior)GP(使用TCP的BGP(Border Gateway P)）
    * IP
      * IPv4
        * 首部长20B，首部长、总长、片偏移的基本单位是4B、1B、8B
        * NAT：实现专用网络地址(Intranet)和公用网络地址(Internet，端口号不同)之间的相互转换
        * 子网划分
        * 协议
          * ARP：对于特定IP地址，查询其对应的物理地址
          * DHCP：给网络中的主机动态分配IP地址
          * ICMP：给主机或路由器报告差错和异常情况 （不发：ICMP、后续分片、组播地址的数据报、特殊地址）
      * IPv6
        * 首部长是40B，地址长度16B，主要解决IPv4的地址耗尽问题
      * PING工作在应用层，它直接使用ICMP

  * 传输层(运输层)：进程（由端口号标识）与进程之间（端到端的通信）

    * IP数据报是要经过路由的存储转发，而TCP/UDP则是在传输层抽象的逻辑信道中传输

    * 套接字/通信端点 = （主机IP地址，端口号）

      * 端口号长16bit
      * 服务端使用的端口号的0~1023被指派给了TCP/IP最重要的一些应用程序（如FTP=21, SMTP=25, DNS=53, HTTP=80）
      * 1024~49151是登记端口号，供没用熟知端口号的应用程序使用，需要在IANA登记
      * 49152~65535是客户端使用的端口号，也叫临时端口

    * UDP

    * ![image-20210316163131442](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229626.png)

      * 无连接的，“尽最大努力交付”
      * 首部仅8B的开销
      * 仅有复用、分用、和差错检测服务。
      * 可以以稳定的速度发送，要容忍一定的数据丢失，不允许有较大的时延
      * 常用于一次性传输较少数据的网络应用。
      * 简单、速度快、实时性好，没有建立连接的时延

    * TCP

      ![image-20210316163356706](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229627.png)

      * 面向连接，可靠交付
        * 顺序号，冗余ACK、超时重传、自动重传机制等
      * 流量控制：滑动窗口，是点对点的概念
      * 拥塞控制：指防止过多数据注入网络，让网络能够承受现有的负荷，是全局概念
        * 慢开始和拥塞避免、快重传、快恢复
      * 对于基于文本数据的Web网页来说，可靠性是非常重要的。
      * 三握四挥
      * ![image-20210316164132732](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229628.png)
      * ![image-20210316164141639](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229629.png)
        * 服务端是在二次握手后完成资源分配的，这容易使服务端收到SYN洪泛攻击，向服务端发送大量的TCP建立请求，但不发送ACK，导致服务端的资源被大量消耗。解决方案是：降低SYN timeout时间让服务端尽快释放半连接状态；采用SYN cookie设置，短时间内连续收到某个IP的重复请求，就认为收到了攻击；采用防火墙等外部安全设施。

  * 会话层

    * 不同主机上的各个进程之间进行会话

  * 表示层

    * 数据变换（加密解密、数据压缩等）

  * 应用层：最复杂，协议最多的一层

    * DNS

      * 域名系统是一个联机分布式数据库系统，C/S模型。
      * 以UDP数据报的方式发送到本地域名服务器
      * 解析方式：递归查询、递归+迭代

    * HTTP

      * 无状态的（也就是同一个服务器的页面时，服务端的响应与第一次被访问时一样，服务器不记得曾经访问过的客户，简化了服务器设计，实际中常用Cookie(存储在用户主机中的文本文件)+DB的方式来跟踪用户的活动），无连接的，基于TCP的

    * HTTP状态码

    * | 1**  | 信息，服务器收到请求，需要请求者继续执行操作       | 100=继续，101=切换协议                        |
      | ---- | -------------------------------------------------- | --------------------------------------------- |
      | 2**  | **成功**，操作被成功接收并处理                     | 200=OK,                                       |
      | 3**  | **重定向，需要进一步的操作以完成请求**             | 305=使用代理                                  |
      | 4**  | **客户端错误**，请求包含语法错误或无法完成请求     | 400=bad request,401=Unauthorized,404Not Found |
      | 5**  | **服务器错误，**服务器在处理请求的过程中发生了错误 | 500=不支持该请求 505=不支持的HTTP版本         |

      

    * HTTPS

      * 默认端口号是443
      * 使用SSL/TLS
        * 公钥加密法

      ![img](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229630.jpeg)

    * HTTP1.0,/1.1/1.2

      * 1.0是非持续连接方式，即每次HTTP请求都要新建一条TCP连接，建立1*RTT+RTT
      * 1.1引入了持续连接方式，收到HTTP响应后暂时不关闭TCP连接，而是等一段时间
        * 非流水线：发送第一个请求，收到第一个响应，发送第二个...
        * 流水线：发送第一个请求，收到第一个响应，发送第2,3,4...个HTTP请求，收到第2,3,4...个响应
      * 2.0不像以往使用文本传输而是采用二进制的方式，与HTTP1.1不兼容
        * 压缩了请求头
        * 多路复用
        * 服务器主动推送
        * 请求优先级等。

  * 

* ![image-20210316171145689](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229631.png)

* 用户点击鼠标后发生的时间顺序

  * 浏览器分析链接指向页面的URL
  * 浏览器向DNS请求解析该URL的IP地址
  * 域名系统解析出xxx服务器的IP地址。
  * 浏览器与该服务器建立TCP连接（默认端口号80）
  * 浏览器发送HTTP请求：GET balabalaa
  * 服务器通过HTTP响应把文件xxx发送给浏览器
  * TCP连接释放
  * 浏览器解释文件xxx，并将Web页显示给用户。

* base64编码

* 百分号编码

  * (百分号编码，%20表示空格 %3d表示= %3f表示? %2f表示/ %26表示&)
  * URL

* ![image-20201217061513276](https://raw.githubusercontent.com/NoSW/CloudImg/main/img/202205281229632.png)

<style class="fallback">body{visibility:hidden}</style><script>markdeepOptions={tocStyle:'long'};</script><!-- Markdeep: --><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js?" charset="utf-8"></script>